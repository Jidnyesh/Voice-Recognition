{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="{% static 'socket.io.js' %}"></script>

    <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <!-- <script src="/lib/jquery.plugin.js"></script> -->


    <title>socket app</title>
</head>

<body class="indigo darken-4">
    <div class="center">
        <button id='canvasx' style="box-shadow: none;border: none;background: transparent;"><canvas id="canvas" onclick="toggleState()"> </canvas></button>

    </div>
    <textarea class="white black-text" id="chat-log" style="width:2000px;height:200px;" readonly></textarea><br/>
    <input id="chat-message-input" type="text" size="0" style="display:none;"/><br/>
    <section class="section container" id="assistant">

        <div class="row" v-for='todo in todos'>
          
        </div>


    </section>


    <!-- Converting audio file to text -->
    <audio class="hide" id="audiofile" src="\\test.wav" controls></audio><br>

    <script src="{% static 'circleanimator.js' %}"></script>

    <script>
        clickclear()
        function clickclear(){
            document.querySelector('#chat-log').value = '';
        }
        let animatedState

        function deanimate() {
            rangeMax = 3
            driver()
            animatedState = false
        }

        function reanimate() {
            rangeMax = 20
            driver()
            animatedState = true
        }
        var roomName = {{ room_name_json }}

        var chatSocket = new WebSocket(
        'ws://' + window.location.host + '/ws/chat/' + roomName + '/');

        chatSocket.onmessage = function(e) {
            var data = JSON.parse(e.data);
            var message = data['message'];
            var response = data['response'];
            document.querySelector('#chat-log').value += (message + '\n');
            document.querySelector('#chat-log').style.fontWeight='bolder';
            };
        chatSocket.onclose = function(e) {
            console.error('Chat socket closed unexpectedly');
        };

        function toggleState() {
                reanimate()
                setTimeout(deanimate, 7000);

                document.querySelector('#chat-message-input').focus();
                document.querySelector('#chat-message-input').onkeyup = function(e) {
                    if (e.keyCode === 13) {  // enter, return
                        document.getElementById('canvasx').click();
                    }
                };

                document.getElementById('canvasx').onclick = function(e) {
                    var messageInputDom = document.querySelector('#chat-message-input');
                    var message = messageInputDom.value;
                    chatSocket.send(JSON.stringify({
                        'message': message
                    }));

                    messageInputDom.value = '';
                };

        }

        deanimate()
    
    </script>
</body>
</html>